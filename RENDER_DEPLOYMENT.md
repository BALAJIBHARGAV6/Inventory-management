# üöÄ Render Deployment Guide

Complete guide to deploy your Inventory Management System backend on Render.

## üìã Prerequisites

- GitHub account with your repository
- Render account (free tier available)
- Supabase account with database setup
- Groq API key for AI features

## üéØ Quick Deploy to Render

### Option 1: Using render.yaml (Recommended)

1. **Push to GitHub**
   ```bash
   git add .
   git commit -m "Add Render configuration"
   git push origin main
   ```

2. **Connect to Render**
   - Go to [Render Dashboard](https://dashboard.render.com/)
   - Click "New +" ‚Üí "Blueprint"
   - Connect your GitHub repository
   - Render will automatically detect `render.yaml`
   - Click "Apply"

3. **Set Environment Variables**
   
   In Render dashboard, add these environment variables:
   
   ```
   SUPABASE_URL=https://your-project.supabase.co
   SUPABASE_SERVICE_KEY=your-supabase-service-role-key
   GROQ_API_KEY=gsk_your-groq-api-key
   CORS_ORIGIN=https://your-app.vercel.app,*.vercel.app,http://localhost:3000
   ```
   
   **Important**: Replace with your actual values!

### Option 2: Manual Setup

1. **Create New Web Service**
   - Go to Render Dashboard
   - Click "New +" ‚Üí "Web Service"
   - Connect your GitHub repository

2. **Configure Service**
   ```
   Name: inventory-management-backend
   Region: Singapore (or closest to you)
   Branch: main
   Root Directory: (leave empty)
   Runtime: Node
   Build Command: cd backend && npm install && npm run build
   Start Command: cd backend && npm start
   ```

3. **Set Environment Variables** (same as above)

4. **Deploy**
   - Click "Create Web Service"
   - Wait for deployment to complete

## üîß Environment Variables Explained

| Variable | Description | Example |
|----------|-------------|---------|
| `SUPABASE_URL` | Your Supabase project URL | `https://abc123.supabase.co` |
| `SUPABASE_SERVICE_KEY` | Service role key from Supabase | `eyJhbGc...` |
| `GROQ_API_KEY` | API key from Groq Console | `gsk_...` |
| `JWT_SECRET` | Auto-generated by Render | (auto) |
| `CORS_ORIGIN` | Allowed frontend origins | See below |
| `NODE_ENV` | Environment mode | `production` |
| `PORT` | Server port | `4000` |

### CORS_ORIGIN Configuration

**Critical for fixing CORS errors!**

Format: Comma-separated list of allowed origins
```
https://inventory-management-ecommerce.vercel.app,*.vercel.app,http://localhost:3000
```

This allows:
- ‚úÖ Your production Vercel app
- ‚úÖ All Vercel preview deployments (*.vercel.app)
- ‚úÖ Local development

## üìç Get Your Render URL

After deployment completes:
1. Go to your service dashboard
2. Copy the URL (e.g., `https://inventory-management-backend.onrender.com`)
3. Test health endpoint: `https://your-app.onrender.com/health`

## üîó Update Frontend Configuration

Update your Vercel environment variables:

```bash
NEXT_PUBLIC_API_URL=https://your-app.onrender.com
```

Steps:
1. Go to Vercel Dashboard
2. Select your project
3. Settings ‚Üí Environment Variables
4. Update `NEXT_PUBLIC_API_URL`
5. Redeploy frontend

## ‚úÖ Verify Deployment

### 1. Health Check
```bash
curl https://your-app.onrender.com/health
```

Expected response:
```json
{
  "status": "ok",
  "timestamp": "2024-01-18T...",
  "database": "configured",
  "environment": "production"
}
```

### 2. Test API Endpoints
```bash
# Products
curl https://your-app.onrender.com/api/products?limit=10

# Inventory stats
curl https://your-app.onrender.com/api/inventory/stats
```

### 3. Check Logs
- Go to Render Dashboard
- Click on your service
- View "Logs" tab
- Look for startup messages and any errors

## üö® Troubleshooting

### CORS Errors Still Appearing?

1. **Check CORS_ORIGIN variable**
   ```bash
   # Must include your exact Vercel URL
   CORS_ORIGIN=https://inventory-management-ecommerce.vercel.app,*.vercel.app
   ```

2. **Check Render logs**
   - Look for "CORS blocked origin:" messages
   - Verify the origin being blocked
   - Add it to CORS_ORIGIN

3. **Restart service**
   - After updating env vars, click "Manual Deploy" ‚Üí "Clear build cache & deploy"

### Database Connection Issues

1. **Verify Supabase credentials**
   - Check SUPABASE_URL format
   - Ensure SERVICE_KEY (not anon key)
   - Test connection in Supabase dashboard

2. **Check database schema**
   - Run migrations if needed
   - Verify tables exist

### Build Failures

1. **Check build logs in Render**
2. **Common issues:**
   - TypeScript errors
   - Missing dependencies
   - Wrong build command

3. **Fix:**
   ```bash
   # Test locally first
   cd backend
   npm install
   npm run build
   npm start
   ```

### Service Not Starting

1. **Check start command**
   ```bash
   cd backend && npm start
   ```

2. **Verify PORT**
   - Render sets PORT automatically
   - Your app should use `process.env.PORT`

3. **Check logs for errors**

## üîÑ Migration from Railway

### Export Environment Variables from Railway

1. Go to Railway project
2. Variables tab
3. Copy all values

### Import to Render

1. Paste into Render environment variables
2. Update CORS_ORIGIN to include Render URL
3. Deploy

### Update Frontend

Change API URL from Railway to Render:
```bash
# Old
NEXT_PUBLIC_API_URL=https://inventory-management-production-4d6b.up.railway.app

# New
NEXT_PUBLIC_API_URL=https://inventory-management-backend.onrender.com
```

## üìä Render Free Tier Limits

- ‚úÖ 750 hours/month (enough for 1 service)
- ‚úÖ Auto-sleep after 15 min inactivity
- ‚úÖ Wakes on request (may take 30-60s)
- ‚úÖ 512 MB RAM
- ‚úÖ Shared CPU

**Note**: First request after sleep may be slow. Consider upgrading for production.

## üéØ Production Checklist

- [ ] All environment variables set
- [ ] CORS_ORIGIN includes production URL
- [ ] Health endpoint returns 200
- [ ] Database connection working
- [ ] API endpoints responding
- [ ] Frontend updated with Render URL
- [ ] Frontend redeployed
- [ ] Test admin login
- [ ] Test product fetching
- [ ] Test order creation
- [ ] Monitor logs for errors

## üîê Security Best Practices

1. **Never commit .env files**
2. **Use strong JWT_SECRET** (Render auto-generates)
3. **Rotate API keys regularly**
4. **Enable Render's DDoS protection**
5. **Monitor logs for suspicious activity**
6. **Use HTTPS only** (Render provides free SSL)

## üìà Monitoring

### Render Dashboard
- View real-time logs
- Monitor CPU/Memory usage
- Check deployment history
- View metrics

### Set Up Alerts
1. Render Dashboard ‚Üí Service ‚Üí Settings
2. Configure notification webhooks
3. Get alerts for:
   - Deploy failures
   - Service crashes
   - High resource usage

## üÜò Support

- **Render Docs**: https://render.com/docs
- **Render Community**: https://community.render.com
- **Check Logs**: Always check Render logs first
- **Health Endpoint**: Use `/health` to verify service status

## üéâ Success!

Your backend is now deployed on Render! 

**Next Steps:**
1. Test all API endpoints
2. Monitor logs for 24 hours
3. Set up monitoring/alerts
4. Consider upgrading for production workloads

---

**Deployed URLs:**
- Backend: `https://your-app.onrender.com`
- Health Check: `https://your-app.onrender.com/health`
- API Base: `https://your-app.onrender.com/api`
